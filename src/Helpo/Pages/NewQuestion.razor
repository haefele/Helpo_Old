@page "/Questions/New"
@attribute [Authorize]

<MudForm>
    <MudCard>
        <MudCardContent>
            <MudTextField T="string"
                          Label="Title"
                          @bind-Value="@_title"
                          Variant="Variant.Filled"
                          HelperText="Enter a short but descriptive title, like an email subject."/>

            <MudTextField T="string"
                          @bind-Value="@_question"
                          Label="Question"
                          Lines="10"
                          Variant="Variant.Filled"
                          HelperText="Try to explain the question in detail, what you're trying to do, what your problem is, and what you tried already." />
            
            <MudTextField T="string" 
                          @bind-Value="@_newTag"
                          HelperText="Type a tag in this text field and press [Enter] or click the + button on the right to add the tag to this question."
                          Label="Tags" 
                          Variant="Variant.Filled"
                          Adornment="Adornment.End"
                          AdornmentIcon="@Icons.Material.Add"
                          OnAdornmentClick="AddTag"
                          Immediate="true"
                          OnKeyDown="TagTextFieldOnKeyDown" />
            
            <MudChipSet AllClosable="true" OnClose="RemoveTag"  >
                @foreach (var tag in _tags)
                {
                    <MudChip Text="@tag" Variant="Variant.Outlined" />
                }
            </MudChipSet>
            
            <MudSelect T="string" 
                       Variant="Variant.Filled"
                       @bind-Value="_application"
                       Label="Application" 
                       OffsetY="true"
                       HelperText="Select the application that your question is about.">
                <MudSelectItem Value="@("c-entron.NET")" />
                <MudSelectItem Value="@("Service-Board")" />
                <MudSelectItem Value="@("Service-Board Online")" />
                <MudSelectItem Value="@("Outlook Add-In")" />
            </MudSelect>
        </MudCardContent>
    </MudCard>
</MudForm>

<MudButton Variant="Variant.Filled"
           StartIcon="@Icons.Material.Add"
           Class="mt-4"
           Style="float: right;"
           Color="Color.Primary">
    Ask this question
</MudButton>

@code {
    #nullable enable
    
    private string? _title = default;

    private string? _question = default;

    private readonly List<string> _tags = new();
    private string? _newTag;
    private void AddTag()
    {
        if (string.IsNullOrWhiteSpace(this._newTag) == false)
        {
            this._tags.Add(_newTag);
            this._newTag = string.Empty;
        }
    }
    private void RemoveTag(MudChip chip)
    {
        this._tags.Remove(chip.Text);
    }
    private void TagTextFieldOnKeyDown(KeyboardEventArgs obj)
    {
        if (obj.Key == "Enter")
        {
            this.AddTag();
        }
    }

    private string? _application = default;
}
